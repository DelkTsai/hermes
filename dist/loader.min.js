!function(t){"use strict";var e={getType:function(t){return Object.prototype.toString.call(t)},proxy:function(t,e){return t?function(){return t.apply(e||this,arguments)}:void 0},forEach:function(t,e){if(t)if(t.forEach)t.forEach.call(t,e);else{var n=this.getType(t);if("[object Array]"===n){for(var r=0;r<t.length;r++)if(e.call(t[r],t[r],r)===!1)return}else if("[object Object]"===n)for(var r in t)if(t.hasOwnProperty(r)&&e.call(t[r],t[r],r)===!1)return}},extend:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},ajax:function(e){var n=null;if(t.XMLHttpRequest)n=new t.XMLHttpRequest;else if(t.ActiveXObject)try{n=new t.ActiveXObject("Msxml2.XMLHTTP")}catch(r){n=new t.ActiveXObjec("Microsoft.XMLHTTP")}if(null===n){e=this.extend({method:"GET",url:null,data:null,isAsync:!0,success:null,error:null},e);var s="";"GET"===e.method&&"[object Object]"===this.getType(e.data)&&(this.forEach(e.data,function(e,n){s+=n+"="+t.encodeURIComponent(e)+"&"}),s=substr(0,s.length-1),e.url+=e.url.indexOf("?")>=0?"&"+s:"?"+s),n.open(e.method,e.url,e.isAsync),"GET"===e.method?n.send(null):"POST"===e.method&&n.send(e.data),n.onreadystatechange=function(){4===n.readyState&&(200===n.status?e.success&&e.success(n.responseText):e.error&&e.error())}}},addEvent:function a(){return document.addEventListener?function(t,e,n){if(t.length)for(var r=0;r<t.length;r++)a(t[r],e,n);else t.addEventListener(e,n,!1)}:function(e,n,r){if(e.length)for(var s=0;s<e.length;s++)a(e[s],n,r);else e.attachEvent("on"+n,function(n){return r.call(e,n||t.event)})}}},n={ProcessStatus:{NOSTART:0,RUNNING:1,PAUSE:2,COMPLETE:3,ERROR:4},ProcessCommand:{PAUSE:0,STOP:1,NONE:2},FileStatus:{NOSTART:0,RUNNING:1,ERROR:2,COMPLETE:3}},r=function(t){this.conf=e.extend({},t),this.handler={onComplete:null,onError:null},this._status=n.FileStatus.NOSTART;var r=navigator.userAgent;this._isIE=r.indexOf("MSIE")>=0,this._body=document.body||document.getElementsByTagName("body")[0]};r.prototype={constructor:r,_onload:function(){this._status=n.FileStatus.COMPLETE,this.runHandler(this.handler.onComplete,this._url)},_onerror:function(){this._status=n.FileStatus.ERROR,this.runHandler(this.handler.onError,this._url)},status:function(){var t=arguments[0];return void 0===t?this._status:void(this._status=t)},process:function(t){if(this._url=t.url,this._url){var r=null;return this._status=n.FileStatus.RUNNING,this._isIE?(r=new Image,r.src=this._url,r.onload=e.proxy(this._onload,this),r.onerror=e.proxy(this._onerror,this)):(r=document.createElement("object"),r.data=this._url,r.width=0,r.height=0,r.onload=e.proxy(this._onload,this),r.onerror=e.proxy(this._onerror,this),this._body.appendChild(r)),this}},bind:function(t,e){return this.handler[t]=e,this},runHandler:function(t,e){return t&&t(e),this}};var s=function(t){this.conf=e.extend({},t),this._cache=[],this._complete=[],this.handler={onItemComplete:null,onItemStart:null,onItemError:null,onComplete:null,onStart:null,onError:null,onPause:null}};s.prototype={constructor:s,_createLoader:function(){var t=new r;return t.bind("onComplete",e.proxy(this._onItemComplete,this)).bind("onError",e.proxy(this._onItemError,this))},_getLoader:function(){for(var t=null,e=0;e<this._cache.length;e++){var r=this._cache[e];if(r.status()!==n.FileStatus.RUNNING){t=r;break}}return null===t&&(t=this._createLoader(),this._cache.push(t)),t},_onItemComplete:function(t){this.runHandler(this.handler.onItemComplete,t),this._complete.push(t),this._toComplete(),this._toContinue(),this._toPause()},_onItemError:function(t){this.runHandler(this.handler.onItemError,t).runHandler(this.handler.onError,t),this._toComplete(),this._toContinue(),this._toPause()},_toComplete:function(){return 0===this._queue.length&&this._status!==n.ProcessStatus.COMPLETE?(this._status=n.ProcessStatus.COMPLETE,this.runHandler(this.handler.onComplete),!0):!1},_toContinue:function(){this._status!==n.ProcessStatus.COMPLETE&&this._command==n.ProcessCommand.NONE&&this._process({queue:this._queue})},_toPause:function(){this._command===n.ProcessCommand.PAUSE&&this._status===n.ProcessStatus.RUNNING&&(this._status=n.ProcessStatus.PAUSE,this.runHandler(this.handler.onPause))},_process:function(){if(this._queue&&(this._command=n.ProcessCommand.NONE,this._status=n.ProcessStatus.RUNNING,!this._toComplete()&&this._queue.length>0)){var t=this._getLoader();if(null!==t){var e=this._queue.pop();e&&(this.runHandler(this.handler.onItemStart,e),t.process({url:e}))}}},process:function(t){return this._queue=t.queue,this.runHandler(this.handler.onStart),this._process(),this},pause:function(){return this._command=n.ProcessCommand.PAUSE,this},goOn:function(){return this._process({queue:this._queue}),this},bind:function(t,e){return this.handler[t]=e,this},runHandler:function(t,e){return t&&t(e),this}};var o={load:function(t){var e=t.deps||null;if(null===e||!e.length)return void console.warn("依赖资源列表为空，本次将不预加载任何内容！");var n={},r=new s;r.bind("onStart",function(){console.log("开始下载")}).bind("onItemStart",function(t){var e=new Date,r=e.getTime();n[t]={},n[t].startTime=r}).bind("onItemComplete",function(t){var e=new Date,r=e.getTime();n[t]&&(n[t].endTime=r),console.log("资源 "+t+"下载完成！")}).bind("onItemError",function(t){console.log("资源 "+t+"加载失败")}).bind("onComplete",function(){console.log(n)}).process({queue:e})}};o.load({deps:["http://labs.qiang.it/labs/preloader/images/bg1.png","http://labs.qiang.it/labs/preloader/images/bg2.jpg","http://labs.qiang.it/labs/preloader/images/bg3.jpg","http://labs.qiang.it/labs/preloader/jquery-test.js","http://labs.qiang.it/labs/preloader/step_2.css","test.js"]});var i={bind:function(){e.addEvent(document,"click",function(e){var n=e.target||e.srcElement,r=n.getAttribute("locate"),s=null,o=null,i=null,a=t.location.href,u=null;if(r){r=r.split("#");var l=lcoate.length;l>=3?(s=r[0],o=r[1],i=r[2]):(o=r[0],i=r[1]),u=new Image,u.src="&u="+a+"&project="+s+"&page="+o+"&region="+i}})}};i.bind()}(window);